:root {
    --player-color: #2563eb; --opponent-color: #dc2626; --highlight-color: #f59e0b;
    --card-width: 7.5%; /* カードの幅をビューポート基準に */
    --card-aspect-ratio: 1.4; /* カードの縦横比 (高さ / 幅) */
    --card-height: calc(var(--card-width) * var(--card-aspect-ratio));
}
html, body {
    overscroll-behavior: none;
    background-color: #111;
}
body {
    font-family: 'Inter', 'Noto Sans JP', sans-serif;
    color: #f9fafb;
    overflow: hidden;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#battlefield-container {
    position: relative;
    width: 90vw; /* ビューポートの幅の90% */
    height: calc(90vw / 1.5); /* プレイマットの縦横比に合わせて高さを計算 */
    max-width: 1200px;
    max-height: 800px;
    background-image: url('../image/battle.png');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
}

.font-orbitron { font-family: 'Orbitron', sans-serif; }

/* 共通スタイル */
.field-slot, .deck, .base, .ui-text, .bases-container, .phase-indicator, .battle-log-pos {
    position: absolute;
    box-sizing: border-box;
}

.card {
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); transform-style: preserve-3d;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); border-radius: 0.5rem; cursor: pointer;
    border: 2px solid #4b5563;
    width: 100%; height: 100%;
}
.card-inner { width: 100%; height: 100%; object-fit: cover; border-radius: 0.375rem; }
.card.rested { transform: rotate(90deg) scale(0.9); }
.card.in-hand:hover { transform: translateY(-20px) scale(1.15); z-index: 100; }
.card.selected { transform: translateY(-15px) scale(1.1); box-shadow: 0 0 20px var(--player-color); border-color: var(--player-color); }
.card.can-attack { box-shadow: 0 0 15px var(--highlight-color); border-color: var(--highlight-color); animation: pulse 1.5s infinite; }
.targetable { animation: pulse-red 1.5s infinite; }
@keyframes pulse { 0%, 100% { box-shadow: 0 0 15px var(--highlight-color); } 50% { box-shadow: 0 0 25px var(--highlight-color); } }
@keyframes pulse-red { 0%, 100% { box-shadow: 0 0 15px var(--opponent-color); border-color: var(--opponent-color);} 50% { box-shadow: 0 0 25px var(--opponent-color); border-color: var(--opponent-color);} }

.field-slot {
    border: 2px dashed #6b7280;
    background-color: rgba(17, 24, 39, 0.5);
    transition: all 0.3s ease;
    border-radius: 0.5rem;
    display: flex; align-items: center; justify-content: center;
}
.field-slot.playable { border-color: var(--player-color); box-shadow: 0 0 15px var(--player-color); }

.deck {
    background: rgba(31, 41, 55, 0.7);
    border: 2px solid #4b5563;
    color: #9ca3af;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-weight: bold; border-radius: 0.5rem;
    padding: 2px;
    font-size: 0.8em;
}

/* --- 各エリアの絶対座標指定 --- */
/* 相手プレイヤーエリア */
#opponent-field-rearguard1 { top: 7.5%; left: 24.5%; width: var(--card-width); height: var(--card-height); }
#opponent-field-rearguard2 { top: 7.5%; left: 34%; width: var(--card-width); height: var(--card-height); }
#opponent-field-vanguard1 { top: 25%; left: 29.25%; width: var(--card-width); height: var(--card-height); }
#opponent-field-vanguard2 { top: 25%; left: 38.75%; width: var(--card-width); height: var(--card-height); }
#opponent-field-support { top: 7.5%; left: 47.5%; width: var(--card-width); height: var(--card-height); }
#opponent-deck { top: 7.5%; left: 69%; width: var(--card-width); height: var(--card-height); }
#opponent-trash { top: 25%; left: 69%; width: var(--card-width); height: var(--card-height); }
#opponent-reiki-deck { top: 7.5%; left: 15%; width: var(--card-width); height: var(--card-height); }
#opponent-reiki-count { top: 23%; left: 15%; width: var(--card-width); text-align: center; }
#opponent-bases-pos { top: 43.5%; left: 29.5%; width: 18%; height: 5%; }

/* プレイヤーエリア */
#player-field-vanguard1 { top: 59%; left: 29.25%; width: var(--card-width); height: var(--card-height); }
#player-field-vanguard2 { top: 59%; left: 38.75%; width: var(--card-width); height: var(--card-height); }
#player-field-rearguard1 { top: 76.5%; left: 24.5%; width: var(--card-width); height: var(--card-height); }
#player-field-rearguard2 { top: 76.5%; left: 34%; width: var(--card-width); height: var(--card-height); }
#player-field-support { top: 76.5%; left: 47.5%; width: var(--card-width); height: var(--card-height); }
#player-deck { top: 76.5%; left: 69%; width: var(--card-width); height: var(--card-height); }
#player-trash { top: 59%; left: 69%; width: var(--card-width); height: var(--card-height); }
#player-reiki-deck { top: 76.5%; left: 15%; width: var(--card-width); height: var(--card-height); }
#player-reiki-count { top: 72%; left: 15%; width: var(--card-width); text-align: center; }
#player-bases-pos { top: 50%; left: 29.5%; width: 18%; height: 5%; }

/* UIテキスト */
.ui-text { font-weight: 600; text-shadow: 1px 1px 3px black; }
#opponent-name { top: 2%; left: 2%; font-size: 1.2em; color: var(--opponent-color); }
#opponent-hand-pos { top: 2%; left: 15%; }
#player-name { bottom: 2%; left: 2%; font-size: 1.2em; color: var(--player-color); }
#player-hand-pos { bottom: 2%; left: 15%; }

/* 拠点コンテナ */
.bases-container { display: flex; gap: 5%; }
.base {
    position: relative;
    border: 2px solid #4b5563; background-color: #1f2937;
    width: 30%; height: 100%; border-radius: 0.25rem;
}
.base.conquered-by-player { border-color: var(--player-color); box-shadow: 0 0 15px var(--player-color); }
.base.conquered-by-opponent { border-color: var(--opponent-color); box-shadow: 0 0 15px var(--opponent-color); }
.gauge-bar { position: absolute; bottom: -10px; left: 0; width: 100%; height: 5px; background-color: #4b5563; border-radius: 2px; }
.gauge-bar-inner { height: 100%; background-color: #f59e0b; border-radius: 2px; transition: width 0.3s ease; }

/* 中央エリア */
#phase-display {
    top: 42%; left: 55%; width: 22%; height: 15%;
    background-color: rgba(17, 24, 39, 0.8);
    box-shadow: 0 0 20px rgba(234, 179, 8, 0.4);
    border-radius: 0.5rem;
    padding: 1%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
#battle-log-container {
    top: 60%; left: 55%; width: 22%; height: 30%;
    background-color: rgba(17, 24, 39, 0.8);
    border-radius: 0.5rem;
    padding: 1.5%;
}

/* その他 */
.attack-effect {
    position: fixed; width: 100px; height: 100px;
    background-image: radial-gradient(circle, white, rgba(255, 100, 100, 0));
    border-radius: 50%; transform: scale(0); pointer-events: none; z-index: 201;
    animation: attack-flash 0.4s ease-out;
}
@keyframes attack-flash { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
.action-button:disabled { filter: grayscale(80%); cursor: not-allowed; opacity: 0.7; }

#player-hand-area {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
}
